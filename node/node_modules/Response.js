module.exports = function(){
	var jade = require('jade');

	var weatherPage = jade.compile(process.cwd() + "/../weather.jade");
	var weather = function(req, res){
	var location =  req['query']['place'];
	var days = req['query']['days'];
		if (location != undefined && days != undefined){
			var url = "http://api.worldweatheronline.com/free/v1/weather.ashx?q=" + location + ",uk&format=json&num_of_days=" + days + "&key=337b499c0cb420a986a9b044842e69d474ed4d96"
			http.get(url, function(resp) {
			 	console.log("Got response: " + res.statusCode);
			 	var body = '';
			 	resp.on('data', function(chunk){
			 		body += chunk
				}).on('end', function(){
					var html = weatherPage(weatherData = body);
			    	res.render(html);
				}).on('error', function(e) {
			 		console.log("Got error: " + e.message);
				});
			
			});

		}
		else {
			var html = weatherPage(weatherData = undefined);
			res.render(html);
		}
	}

  	return {Weather: weather};

}