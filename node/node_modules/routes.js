module.exports = function(){
	var express = require('express'),
	app = express(),
	fs = require('fs'),
	path = require('path');


	server = require('http').createServer(app);

	app.use(express.bodyParser());
	app.use(express.cookieParser('Sometimes I pretend I"m a car.'));
	app.use(express.session());
	app.use(function(req, res, next){
		var err = req.session.error,
		msg = req.session.success;
		delete req.session.error;
		delete req.session.success;
		res.locals.message = '';
		if (err) res.locals.message = '<p class="msg error">' + err + '</p>';
		if (msg) res.locals.message = '<p class="msg success">' + msg + '</p>';
		next();
	});

	app.set('view engine', 'jade');


	app.get('/', function(req, res){
	  res.redirect('/weather.html');
	});

	app.get('/:file',  function (req, res) {
	  var file = req.params.file;
	  res.sendfile(path.resolve(process.cwd() + "/../" + file));

	});

	app.get('/js/libs/:lib/:file', function (req, res) {
	  var file = req.params.file,
	  lib = req.params.lib;
	 res.sendfile(path.resolve(process.cwd() + "/../js/libs/" + lib + '/' + file));
	});

	app.get('/js/libs/:lib/media/js/:file', function (req, res) {
	  var file = req.params.file,
	  lib = req.params.lib,
	  sub1 = req.params.sub1,
	  sub2 = req.params.sub2;
	 res.sendfile(path.resolve(process.cwd() + "/../js/libs/" + lib + '/media/js/' + file));
	});

	app.get('/js/libs/:lib/:sub/:file', function (req, res) {
	  var file = req.params.file,
	  lib = req.params.lib,
	  sub = req.params.sub;
	 res.sendfile(path.resolve(process.cwd() + "/../js/libs/" + lib + '/'+sub+'/' + file));
	});

	app.get('/css/:file', function (req, res) {
	  var file = req.params.file,
	    folder = req.params.folder;
	    res.sendfile(path.resolve(process.cwd() + "/../css/" + file));
	});
	app.get('/fonts/:file', function (req, res) {
	  var file = req.params.file,
	    folder = req.params.folder;
	    res.sendfile(path.resolve(process.cwd() + "/../fonts/" + file));
	});

	
	app.post('/CreateCourseList', function(req, res){
		response.Post(req, res);
	});


	return server;
}